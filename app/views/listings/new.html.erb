<!DOCTYPE html>
<!--Written by: Akaljot Cheema -->
<!--Maps and GPS portions written by: Jhoong Roh -->
<html>
  <head>
    <meta charset="utf-8"> 
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link href="assets/css/main.css" rel="stylesheet">
	<link href="assets/css/login.css" rel="stylesheet">
	<link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">

  </head>
  <style>
	.form-inline .form-group{
		margin-left: 0;
		margin-right: 0;
	}
	.main-container{
		background-color: #f1f1f1;
        padding-left: 50px;
        padding-top: 50px;
	}
    body{
        background-color: #f1f1f1;
    }
	.btn{
		  border: 1px solid #3079ed;
		  color: #ffffff;
		  text-shadow: 0 1px rgba(0,0,0,0.1);
		  background-color: #4d90fe;
		  background-image: -webkit-gradient(linear,left top,left bottom,from(#4d90fe),to(#4787ed));
		  background-image: -webkit-linear-gradient(top,#4d90fe,#4787ed);
		  background-image: -moz-linear-gradient(top,#4d90fe,#4787ed);
		  background-image: -ms-linear-gradient(top,#4d90fe,#4787ed);
		  background-image: -o-linear-gradient(top,#4d90fe,#4787ed);
		  background-image: linear-gradient(top,#4d90fe,#4787ed);
	}
	.btn:hover{
		  border: 1px solid #2f5bb7;
		  color: #ffffff;
		  text-shadow: 0 1px rgba(0,0,0,0.3);
		  background-color: #357ae8;
		  background-image: -webkit-gradient(linear,left top,left bottom,from(#4d90fe),to(#357ae8));
		  background-image: -webkit-linear-gradient(top,#4d90fe,#357ae8);
		  background-image: -moz-linear-gradient(top,#4d90fe,#357ae8);
		  background-image: -ms-linear-gradient(top,#4d90fe,#357ae8);
		  background-image: -o-linear-gradient(top,#4d90fe,#357ae8);
		  background-image: linear-gradient(top,#4d90fe,#357ae8);
	}
	.btn:active{
		background-color: #357ae8;
		background-image: -webkit-gradient(linear,left top,left bottom,from(#4d90fe),to(#357ae8));
		background-image: -webkit-linear-gradient(top,#4d90fe,#357ae8);
		background-image: -moz-linear-gradient(top,#4d90fe,#357ae8);
		background-image: -ms-linear-gradient(top,#4d90fe,#357ae8);
		background-image: -o-linear-gradient(top,#4d90fe,#357ae8);
		background-image: linear-gradient(top,#4d90fe,#357ae8);
		-webkit-box-shadow: inset 0 1px 2px rgb	a(0,0,0,0.3);
		-moz-box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);
		box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);
	}
  </style>
  <body>
      <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="container">
              <div class="navbar-header">
                  <button class="navbar-toggle" data-target=".navbar-collapse"
                      data-toggle="collapse" type="button"><span class=
                          "icon-bar"></span> <span class="icon-bar"></span> <span class=
                              "icon-bar"></span></button> <a class="navbar-brand" href=
                                  "/">CR<i class="fa fa-circle"></i>WDCAST</a>
              </div>
              
              <div class="navbar-collapse collapse">
                  <div class="nav navbar-nav navbar-right" style=
                      "margin-left: 2em">
                      <section>
                          <div class=
                              "morph-button morph-button-modal morph-button-modal-3 morph-button-fixed">
                              <button type="button">Login</button>
                              
                              <div class="morph-content">
                                  <div>
                                      <div class=
                                          "content-style-form content-style-form-1">
                                          <span class="icon icon-close"></span>
                                          
                                          <h2>Login</h2>
                                          
                                          <form>
                                              <p><label>Email</label><input type=
                                                  "text"></p>
                                                  
                                                  <p>
                                                  <label>Password</label><input type=
                                                      "password"></p>
                                                      
                                                      <p><button>Login</button></p>
                                                      </form>
                                      </div>
                                  </div>
                              </div>
                          </div><!-- morph-button -->
                          
                          <div class=
                              "morph-button morph-button-modal morph-button-modal-3 morph-button-fixed">
                              <button type="button">Signup</button>
                              
                              <div class="morph-content">
                                  <div>
                                      <div class=
                                          "content-style-form content-style-form-2">
                                          <span class="icon icon-close"></span>
                                          
                                          <h2>Sign Up</h2>
                                          
                                          <form>
                                              <p><label>Email</label><input type=
                                                  "text"></p>
                                                  
                                                  <p>
                                                  <label>Password</label><input type=
                                                      "password"></p>
                                                      
                                                      <p><label>Repeat
                                                          Password</label><input type=
                                                              "password"></p>
                                                              
                                                              <p><button>Sign Up</button></p>
                                                              </form>
                                      </div>
                                  </div>
                              </div>
                          </div><!-- morph-button -->
                          
                          <div class=
                              "morph-button morph-button-modal morph-button-modal-3 morph-button-fixed">
                              <button onclick="location.href='/listings/new'"
                                  type="button">Create</button>
                          </div>
                          
                          <div class=
                              "morph-button morph-button-modal morph-button-modal-3 morph-button-fixed">
                              <button onclick="location.href='/search'"
                                  type="button">Search</button>
                          </div>
                          
                      </section>
                  </div>
              </div><!-- /form-mockup -->
          </div><!--/.nav-collapse -->
      </div>
      
	<div class="main-container">
      <h2>Create your listing</h2>
      <form class="form-horizontal" role="form">
	  
		<div class="form-group">
          <label class="control-label col-lg-1" for="title">Title</label>
          <div class="col-lg-4">
            <input type="text" class="form-control" id="title" placeholder="Enter title">
          </div>
        </div>
		
        <div class="form-group">
          <label class="control-label col-lg-1" for="height">Height</label>
          <div class="col-lg-2">
            <input type="number" class="form-control" id="height" placeholder="Enter height">
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-lg-1" for="width">Width</label>
          <div class="col-lg-2">          
            <input type="number" class="form-control" id="width" placeholder="Enter width">
          </div>
        </div>

    <div class="form-group">
          <label class="control-label col-lg-1" for="time">Time per click</label>
          <div class="col-lg-2">          
            <input type="number" class="form-control" id="time" placeholder="Enter time (s)">
          </div>
        </div>
		
		<div class="form-group">
          <label class="control-label col-lg-1" for="views">Views per week</label>
          <div class="col-lg-2">          
            <input type="number" class="form-control" id="views" placeholder="Enter views">
          </div>
        </div>
		
		<div class="form-group">
          <label class="control-label col-lg-1" for="cost">Cost per week</label>
          <div class="col-lg-2">          
            <input type="number" class="form-control" id="cost" placeholder="Enter cost">
          </div>
        </div>
		
		<div class="form-group">
          <label class="control-label col-lg-1" for="resolution">Resolution</label>
          <div class="col-lg-2">          
            <input type="number" class="form-control" id="resolution" placeholder="Enter resolution">
          </div>
        </div>
		
		<div class="form-group">
			<label class="col-lg-1 control-label">Address</label>
			<div class="col-lg-8">
				<div class="form-inline">
					<div class="form-group">
						<input type="text" class="form-control address" id="street" placeholder="Enter street">
					</div>
					<div class="form-group">
						<input type="text" class="form-control address" id="city" placeholder="Enter city">
					</div>
                    <div class="form-group">
                        <input type="text" class="form-control address" id="state" placeholder="Enter state">
                    </div>
					<div class="form-group">
						<input type="number" class="form-control address" id="zip" placeholder="Enter zipcode">
					</div>
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-lg-1 control-label">GPS Location</label>
			<div class="col-lg-8">
				<div class="form-inline">
					<div class="form-group">
						<input type="text" class="form-control gps" id="lat" placeholder="Enter latitude">
					</div>
					<div class="form-group">
						<input type="text" class="form-control gps" id="lng" placeholder="Enter longitude">
					</div>
            </div><br>
            <div style='width: 800px;'>
               <div id="select_location" style='width: 800px; height: 400px;'></div>
            </div>
         </div>
      </div><br>
      
		
		<div class="fileinput fileinput-new input-group col-lg-8" data-provides="fileinput">
			<span class="input-group-addon btn btn-default btn-file"><span class="fileinput-new">Upload Image</span><span class="fileinput-exists">Change</span><input type="file" name="..."></span>
			<div class="form-control" data-trigger="fileinput"><i class="glyphicon glyphicon-file fileinput-exists"></i> <span class="fileinput-filename"></span></div>
			<a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">Remove</a>
		</div>

		
		<div class="form-group">
			<label class="col-lg-1" for="description">Description</label>
			<div class="col-lg-7">
			<textarea class="form-control" rows="6" id="description" placeholder="Enter more information"></textarea>
			</div>
		</div>
		
        <div class="form-group">        
          <div class="col-lg-offset-1 col-lg-10">
            <button type="submit" class="btn btn-default" id="submit">Submit</button>
          </div>
        </div>
		
      </form>
    </div>
	<script type="text/javascript">
       $(document).ready(function() {
       var oldMarker;
       handler = Gmaps.build('Google');

       //When the address changes, create a marker on the map
       $('.address').change(function() {
          listingStreet = document.getElementById('street').value;
          listingCity = document.getElementById('city').value;
          listingState = document.getElementById('state').value;
          listingZip = document.getElementById('zip').value;
          
          if ((listingStreet != "") && (listingCity != "") && (listingState != "") && (listingZip != "")){
             clearGPS();
             //Next iteration, stick with Google. Open source ones are terrible
             var url = "http://nominatim.openstreetmap.org/search?q=";
             url += listingStreet.replace(" ","+") + ",";
             url += listingCity.replace(" ","+") + ",";
             url += listingState + "," + listingZip;
             url += "&format=json";
             //Get request the GPS coordinates of this address
             $.ajax({
                url: url,
                type: "GET",
                success: function( data ) {
                   json = { "lat": data[0]["lat"], "lng": data[0]["lon"] };
                   if (oldMarker != null){
                     handler.removeMarker(oldMarker);
                   }
                   oldMarker = handler.addMarker(json, { "draggable": true } );
                   oldMarker.panTo(); 
                   handler.getMap().setZoom(14);
                   markerMouseUp();
                }
             });
         }
       });
         
       //When the user inputs GPS coordinates, create a marker
       $('.gps').change(function() {
          listingLat = document.getElementById('lat').value;
          listingLng = document.getElementById('lng').value;
          
          if ((listingLat != "") && (listingLng != "")){
             clearAddress(); 
             if (oldMarker != null){
               handler.removeMarker(oldMarker);
             }
             json = { "lat": listingLat, "lng": listingLng };
             oldMarker = handler.addMarker(json, { "draggable": true } );
             oldMarker.panTo(); 
             handler.getMap().setZoom(14);
             markerMouseUp();
          }
       });
       
       $('#submit').click(function() {
          listingTitle = $('#title').val();
          listingHeight = $('#height').val();
          listingWidth = $('#width').val();
          listingTime = $('#time').val();
          listingViews = $('#views').val();  
          listingCost = $('#cost').val();
          listingResolution = $('#resolution').val();
          listingStreet = $('#street').val();
          listingCity = $('#city').val();
          listingState = $('#state').val();
          listingZip = $('#zip').val();
          listingLat = $('#lat').val();
          listingLng = $('#lng').val();
          listingDescription = $('#description').val();
          alert(listingDescription);
          alert(window.location.protocol + '//' + window.location.host + "/api/create_listing/");
          $.ajax({
              type: 'POST',
              url: window.location.protocol + '//' + window.location.host + "/api/create_listing/",
              data: JSON.stringify({ title: listingTitle, height: listingHeight, width: listingWidth,
                  time_per_click: listingTime, views_per_week: listingViews, cost_per_week: listingCost,
                  screen_resolution: listingResolution, street: listingStreet, city: listingCity, 
                  state: listingState, zip: listingZip, 
                  latitude: listingLat, longitude: listingLng, description: listingDescription }),
              contentType: "application/json",
              dataType: "json",
              success: function(data) { alert("Shit"); },
              failure: function(data) { alert("Failure"); }
            });
       });

      function handle_response(data) {
        alert("Got data successfully!");
      }

       //Add markers when the user interacts with the map
       handler.buildMap({ internal: {id: 'select_location'}, provider: { zoom: 10, center: new google.maps.LatLng(37.75, -122.2833)} }, function(){
          google.maps.event.addListener(handler.getMap(), 'click', function(object){
             var lat = object.latLng.lat();
             var lng = object.latLng.lng();
             var json = { "lat": object.latLng.lat(), "lng": object.latLng.lng() };
             if (oldMarker != null){
                handler.removeMarker(oldMarker);
             }
             oldMarker = handler.addMarker(json, { "draggable": true } );
             setLatLng(lat, lng);
             markerMouseUp(); 
          });
          handler.fitMapToBounds();
       });
      
      //When the user stops dragging the marker, we set the GPS fields
      function markerMouseUp() {
         google.maps.event.addListener(oldMarker.getServiceObject(), 'mouseup', function(object){
            lat = object.latLng.lat();
            lng = object.latLng.lng();
            setLatLng(lat, lng);
         });
      }
      //Set the GPS fields while clearing the address fields
      function setLatLng(lat, lng){
         document.getElementById('lat').value = lat;
         document.getElementById('lng').value = lng;
         clearAddress();
      }
      //Clear the address fields.
      function clearAddress(){
         document.getElementById('street').value = null;
         document.getElementById('city').value = null;
         document.getElementById('state').value = null;
         document.getElementById('zip').value = null;
      }
      //Clear the GPS fields
      function clearGPS(){
         document.getElementById('lat').value = null;
         document.getElementById('lng').value = null;
      }
    });
    </script>
	
    <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
    <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js"></script>
  </body>
</html>
